<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NexMeet Â· Chat</title>

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500&display=swap"
    rel="stylesheet"
  />

  <!-- Font Awesome for Icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#FF3D6D",
            "primary-hover": "#E02B5A",
            secondary: "#FF90A8",
            "light-bg": "#FFF0F4",
            "dark-text": "#1A1A1A",
            "card-bg": "rgba(255, 255, 255, 0.95)",
          },
          fontFamily: {
            playfair: ["Playfair Display", "serif"],
            poppins: ["Poppins", "sans-serif"],
          },
        },
      },
    };
  </script>

  <!-- Custom CSS -->
  <style>
    /* Sidebar transition */
    .sidebar {
      transition: transform 0.3s ease-in-out;
    }
    .sidebar.hidden {
      transform: translateX(-100%);
    }

    /* Chat scrollbar styling */
    .chat-container {
      height: calc(100vh - 180px);
      overflow-y: auto;
    }
    .chat-container::-webkit-scrollbar {
      width: 6px;
    }
    .chat-container::-webkit-scrollbar-thumb {
      background: rgba(255, 144, 168, 0.6);
      border-radius: 3px;
    }

    /* Message bubbles */
    .message {
      max-width: 70%;
      margin-bottom: 1rem;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      word-wrap: break-word;
    }
    .message.sent {
      background: #ff90a8;
      color: white;
      margin-left: auto;
    }
    .message.received {
      background: #ffd1dc;
      color: #333;
    }
  </style>
</head>
<body class="bg-light-bg text-dark-text min-h-screen flex flex-col font-poppins">
  <!-- Navbar -->
  <nav class="bg-card-bg p-4 flex justify-between items-center shadow-lg sticky top-0 z-50">
    <div class="flex items-center gap-4">
      <div id="hamburger" class="text-2xl text-primary cursor-pointer md:hidden">
        <i class="fas fa-bars"></i>
      </div>
      <div class="text-2xl text-primary font-playfair">NexMeet</div>
    </div>
    <div class="hidden md:block relative w-1/3">
      <i class="fas fa-search absolute top-1/2 left-3 transform -translate-y-1/2 text-secondary"></i>
      <input
        type="text"
        placeholder="Search friends, rooms, or channels..."
        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/30"
        aria-label="Search"
      />
    </div>
    <div class="relative flex items-center gap-4">
      <div class="relative cursor-pointer">
        <i class="fas fa-bell text-xl text-secondary"></i>
        <span
          class="absolute -top-1 -right-2 bg-primary text-white text-xs px-1 rounded-full"
          >3</span
        >
      </div>
      <div class="relative cursor-pointer">
        <i class="fas fa-video text-xl text-secondary"></i>
      </div>
      <div class="relative flex items-center gap-2 cursor-pointer profile" role="button" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <img
          src="https://via.placeholder.com/40"
          alt="User Profile"
          id="profile-pic"
          class="w-10 h-10 rounded-full object-cover"
        />
        <span id="user-name" class="text-sm">Guest</span>
        <span
          class="absolute -top-1 -right-1 bg-primary text-white text-xs px-2 py-1 rounded-full"
          >3</span
        >
        <div
          class="dropdown hidden absolute top-12 right-0 bg-card-bg rounded-lg shadow-lg z-50"
        >
          <a
            href="#"
            id="view-profile"
            class="block px-4 py-2 text-sm text-dark-text hover:bg-primary hover:text-white"
            >View Profile</a
          >
          <a
            href="#"
            id="settings"
            class="block px-4 py-2 text-sm text-dark-text hover:bg-primary hover:text-white"
            >Settings</a
          >
          <a
            href="#"
            id="sign-out"
            class="block px-4 py-2 text-sm text-dark-text hover:bg-primary hover:text-white"
            >Sign Out</a
          >
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="flex flex-1 mt-4 mx-4 gap-4">
    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="sidebar hidden md:block fixed md:relative top-16 bottom-0 w-64 bg-card-bg rounded-lg p-4 shadow-lg z-40"
    >
      <h3 class="text-primary text-lg font-medium mb-4">Navigate</h3>
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Home"
        ><i class="fas fa-home"></i> Home</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Find Friends"
        ><i class="fas fa-user-plus"></i> Find Friends</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Rooms"
        ><i class="fas fa-door-open"></i> Rooms</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Chats"
        ><i class="fas fa-comments"></i> Chats</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Call Logs"
        ><i class="fas fa-phone"></i> Call Logs</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Notifications"
        ><i class="fas fa-bell"></i> Notifications</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Store"
        ><i class="fas fa-store"></i> Store</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Profile"
        ><i class="fas fa-user"></i> Profile</a
      >
      <a
        href="#"
        class="flex items-center gap-2 px-3 py-2 text-sm text-dark-text rounded-lg hover:bg-primary hover:text-white"
        aria-label="Settings"
        ><i class="fas fa-cog"></i> Settings</a
      >
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col">
      <!-- Chat Rooms Section -->
      <div class="card bg-card-bg p-6 rounded-xl shadow-lg mb-6">
        <h2 class="text-lg font-medium text-dark-text mb-4">Available Rooms</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="room bg-primary p-4 rounded-lg text-white flex flex-col justify-between">
            <div>
              <h3 class="text-xl font-semibold">Code Lovers</h3>
              <p class="mt-2">Discuss coding challenges &amp; tips.</p>
            </div>
            <button class="mt-4 bg-primary-hover px-3 py-1 rounded-md font-medium w-max transition transform hover:scale-105">
              Join Room
            </button>
          </div>
          <div class="room bg-secondary p-4 rounded-lg text-dark-text flex flex-col justify-between">
            <div>
              <h3 class="text-xl font-semibold">Movie Buffs</h3>
              <p class="mt-2">Share your favorite films.</p>
            </div>
            <button class="mt-4 bg-primary px-3 py-1 rounded-md font-medium w-max text-white transition transform hover:scale-105">
              Join Room
            </button>
          </div>
          <div class="room bg-white p-4 rounded-lg text-dark-text flex flex-col justify-between border border-gray-200">
            <div>
              <h3 class="text-xl font-semibold">Travel Stories</h3>
              <p class="mt-2">Exchange adventure tales.</p>
            </div>
            <button class="mt-4 bg-primary px-3 py-1 rounded-md font-medium w-max text-white transition transform hover:scale-105">
              Join Room
            </button>
          </div>
        </div>
      </div>

      <!-- Chat Window Section -->
      <div class="flex-1 flex flex-col">
        <div class="card bg-card-bg p-6 rounded-xl shadow-lg flex flex-col">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-medium text-dark-text">Code Lovers Chat</h2>
            <div class="flex items-center gap-3">
              <div class="relative cursor-pointer">
                <i class="fas fa-phone text-secondary text-xl"></i>
              </div>
              <div class="relative cursor-pointer">
                <i class="fas fa-video text-secondary text-xl"></i>
              </div>
              <div class="relative cursor-pointer">
                <i class="fas fa-info-circle text-secondary text-xl"></i>
              </div>
            </div>
          </div>
          <div id="chat-messages" class="chat-container p-4 bg-white rounded-lg mb-4 flex flex-col"></div>
          <div class="chat-input flex gap-2">
            <button
              id="emoji-btn"
              class="px-3 py-2 bg-primary text-white rounded-full hover:bg-primary-hover transition-all"
              aria-label="Emoji Picker"
            >
              ð
            </button>
            <input
              type="text"
              id="message-input"
              class="flex-1 p-2 border border-gray-300 rounded-full focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/30"
              placeholder="Type a message..."
              aria-label="Message input"
            />
            <button
              id="send-message"
              class="px-4 py-2 bg-primary text-white rounded-full hover:bg-primary-hover transition-all"
            >
              Send
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Footer -->
  <footer class="bg-card-bg p-4 text-center text-gray-600 text-sm mt-auto">
    <p>
      Â© 2025 NexMeet. All rights reserved.
      <a href="#" class="text-primary hover:underline">Privacy Policy</a> |
      <a href="#" class="text-primary hover:underline">Terms of Service</a>
    </p>
  </footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <!-- Simple Emoji Picker (TinyEmoji) -->
  <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@4.6.2/dist/emoji-button.min.js"></script>

  <script>
    // **Security Warning**: Do not hardcode Firebase config in production.
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID",
    };

    // Initialize Firebase
    try {
      firebase.initializeApp(firebaseConfig);
      console.log("Firebase initialized successfully");
    } catch (error) {
      console.error("Firebase initialization failed:", error);
    }

    // DOM Elements
    const hamburger = document.getElementById("hamburger");
    const sidebar = document.getElementById("sidebar");
    const profileElem = document.querySelector(".profile");
    const dropdown = document.querySelector(".profile .dropdown");
    const messageInput = document.getElementById("message-input");
    const sendButton = document.getElementById("send-message");
    const chatMessages = document.getElementById("chat-messages");
    const emojiBtn = document.getElementById("emoji-btn");

    document.addEventListener("DOMContentLoaded", () => {
      const auth = firebase.auth();
      const db = firebase.database();

      // Toggle Sidebar
      hamburger.addEventListener("click", () => {
        sidebar.classList.toggle("hidden");
      });

      // Toggle Profile Dropdown
      profileElem.addEventListener("click", (e) => {
        e.stopPropagation();
        const isExpanded = profileElem.getAttribute("aria-expanded") === "true";
        if (isExpanded) {
          gsap.to(dropdown, {
            opacity: 0,
            y: -10,
            duration: 0.3,
            onComplete: () => {
              dropdown.style.display = "none";
              profileElem.setAttribute("aria-expanded", "false");
            },
          });
        } else {
          dropdown.style.display = "block";
          gsap.fromTo(
            dropdown,
            { opacity: 0, y: -10 },
            {
              opacity: 1,
              y: 0,
              duration: 0.3,
              onComplete: () => {
                profileElem.setAttribute("aria-expanded", "true");
              },
            }
          );
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!profileElem.contains(e.target)) {
          dropdown.style.display = "none";
          profileElem.setAttribute("aria-expanded", "false");
        }
      });

      // Firebase Auth State
      auth.onAuthStateChanged((user) => {
        if (user) {
          document.getElementById("user-name").textContent =
            user.displayName || user.email || "User";
          document.getElementById("profile-pic").src =
            user.photoURL || "https://via.placeholder.com/40";
        } else {
          document.getElementById("user-name").textContent = "Guest";
          document.getElementById("profile-pic").src =
            "https://via.placeholder.com/40";
          // Optionally redirect to login:
          // window.location.href = 'index.html';
        }
      });

      // Emoji Picker Setup
      const picker = new EmojiButton({
        position: "top-start",
        theme: "light",
      });
      picker.on("emoji", (selection) => {
        messageInput.value += selection.emoji;
        messageInput.focus();
      });
      emojiBtn.addEventListener("click", () => picker.togglePicker(emojiBtn));

      // Load and Display Messages
      const roomId = "code-lovers"; // Example room
      const messagesRef = db.ref(`rooms/${roomId}/messages`);
      messagesRef.on(
        "child_added",
        (snapshot) => {
          const msg = snapshot.val();
          const isSent =
            firebase.auth().currentUser &&
            msg.uid === firebase.auth().currentUser.uid;
          const messageEl = document.createElement("div");
          messageEl.className = `message ${
            isSent ? "sent" : "received"
          } flex flex-col`;
          messageEl.innerHTML = `
            <span class="text-xs text-gray-500 mb-1">${
              msg.sender
            } Â· ${new Date(msg.timestamp).toLocaleTimeString()}</span>
            <span class="text-sm">${msg.text}</span>
          `;
          chatMessages.appendChild(messageEl);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        },
        (error) => {
          console.error("Message load failed:", error);
        }
      );

      // Send Message
      const sendMessage = () => {
        const user = auth.currentUser;
        const text = messageInput.value.trim();
        if (!user || !text) return;
        const newMsg = {
          uid: user.uid,
          sender: user.displayName || user.email || "User",
          text,
          timestamp: Date.now(),
        };
        messagesRef
          .push(newMsg)
          .then(() => {
            messageInput.value = "";
          })
          .catch((error) => {
            console.error("Send message failed:", error);
          });
      };

      sendButton.addEventListener("click", sendMessage);
      messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });

      // GSAP Entrance Animations
      gsap.from(".room", {
        scale: 0.9,
        opacity: 0,
        stagger: 0.1,
        duration: 0.4,
        ease: "power3.out",
      });
      gsap.from(".message", {
        y: 10,
        opacity: 0,
        stagger: 0.05,
        duration: 0.3,
        ease: "power3.out",
      });

      // Sign Out
      document
        .querySelectorAll("#sign-out, #sidebar-sign-out")
        .forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            auth
              .signOut()
              .then(() => {
                window.location.href = "index.html";
              })
              .catch((error) => {
                console.error("Sign out failed:", error);
              });
          });
        });
    });
  </script>
</body>
</html>
